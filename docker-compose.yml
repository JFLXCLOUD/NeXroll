# NeXroll Docker Compose Configuration
# Documentation: https://github.com/JFLXCLOUD/NeXroll

services:
  nexroll:
    image: jbrns/nexroll:latest
    container_name: nexroll
    restart: unless-stopped
    
    ports:
      - "9393:9393"
    
    volumes:
      # Prerolls directory - mount your NAS or local prerolls folder here
      # Format: /your/host/path:/data/prerolls

      # Examples:
      #   - /mnt/user/media/prerolls:/data/prerolls   (Unraid)
      #   - /volume1/media/prerolls:/data/prerolls    (Synology)
      #   - /home/user/prerolls:/data/prerolls        (Linux)
      - /path/to/your/prerolls:/data/prerolls
      
      # Persistent data (database, logs, thumbnails)
      - nexroll-data:/data
    
    environment:
      # Timezone - important for schedule accuracy
      # Find yours at: https://en.wikipedia.org/wiki/List_of_tz_database_time_zones
      - TZ=${TZ:-America/New_York}
      
      # Plex Configuration (optional - can also configure in UI)
      # Get your token: https://support.plex.tv/articles/204059436-finding-an-authentication-token-x-plex-token/
      - PLEX_TOKEN=${PLEX_TOKEN:-}
      - PLEX_URL=${PLEX_URL:-http://host.docker.internal:32400}
      
      # Jellyfin Configuration (optional - can also configure in UI)
      - JELLYFIN_URL=${JELLYFIN_URL:-}
      - JELLYFIN_API_KEY=${JELLYFIN_API_KEY:-}
      
      # NeX-Up: Radarr Integration (optional - for automatic trailer downloads)
      - RADARR_URL=${RADARR_URL:-}
      - RADARR_API_KEY=${RADARR_API_KEY:-}
      
      # NeX-Up: Sonarr Integration (optional - for automatic trailer downloads)
      - SONARR_URL=${SONARR_URL:-}
      - SONARR_API_KEY=${SONARR_API_KEY:-}
    
    # Health check to ensure NeXroll is running properly
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9393/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    
    # Optional: Add labels for reverse proxy (Traefik example)
    # labels:
    #   - "traefik.enable=true"
    #   - "traefik.http.routers.nexroll.rule=Host(`nexroll.yourdomain.com`)"
    #   - "traefik.http.services.nexroll.loadbalancer.server.port=9393"
    
    # Uncomment to allow access to host network (alternative to host.docker.internal)
    # network_mode: host
    
    # Optional: Resource limits
    # deploy:
    #   resources:
    #     limits:
    #       cpus: '2'
    #       memory: 2G
    #     reservations:
    #       cpus: '0.5'
    #       memory: 512M

volumes:
  nexroll-data:
    driver: local

# =============================================================================
# EXAMPLES
# =============================================================================

# Example with Plex in the same compose stack:
# services:
#   plex:
#     image: plexinc/pms-docker:latest
#     container_name: plex
#     network_mode: host
#     environment:
#       - PLEX_CLAIM=${PLEX_CLAIM}
#       - TZ=${TZ:-America/New_York}
#     volumes:
#       - plex-config:/config
#       - /path/to/media:/media
#       - /path/to/prerolls:/prerolls
# 
#   nexroll:
#     image: jbrns/nexroll:latest
#     container_name: nexroll
#     ports:
#       - "9393:9393"
#     volumes:
#       - /path/to/prerolls:/data/prerolls
#       - nexroll-data:/data
#     environment:
#       - PLEX_URL=http://plex:32400
#       - TZ=${TZ:-America/New_York}
#     depends_on:
#       - plex
# 
# volumes:
#   plex-config:
#   nexroll-data:
